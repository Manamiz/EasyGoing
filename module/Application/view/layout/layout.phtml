<?php
   echo $this->doctype();
?>

<?php
   use Zend\Session\Config\SessionConfig;
   use Zend\Session\Container;

   $sessionUser = new container('user');
?>

<html lang="en">
   <head>
      <meta charset="utf-8">
      <?php echo $this->headTitle('EasyGoing')->setSeparator(' - ')->setAutoEscape(false) ?>

      <?php echo $this->headMeta()
         ->appendName('viewport', 'width=device-width, initial-scale=1.0')
         ->appendHttpEquiv('X-UA-Compatible', 'IE=edge')
      ?>

        <!-- Styles -->
      <?php
      	if ($_SERVER['APPLICATION_ENV'] == 'development')
      	{
      		echo $this->headLink(array('rel' => 'shortcut icon', 'type' => 'image/vnd.microsoft.icon', 'href' => $this->basePath() . '/img/logo.png'))
                     ->prependStylesheet($this->basePath() . '/css/style.css')
                     ->prependStylesheet($this->basePath() . '/css/libraries/bootstrap-datepicker.css')
                     ->prependStylesheet($this->basePath() . '/css/libraries/bootstrap-datetimepicker.min.css')
                     ->prependStylesheet($this->basePath() . '/css/libraries/bootstrap.min.css')
                     ->prependStylesheet($this->basePath() . '/css/libraries/contextmenu.css');

      	}
      	else
      	{
      		echo $this->headLink(array('rel' => 'shortcut icon', 'type' => 'image/vnd.microsoft.icon', 'href' => $this->basePath() . '/img/logo.png'))
                     ->prependStylesheet($this->basePath() . '/css/style.css')
                     ->prependStylesheet($this->basePath() . '/css/libraries/bootstrap-datepicker.css')
                     ->prependStylesheet($this->basePath() . '/css/libraries/bootstrap-datetimepicker.min.css')
                     ->prependStylesheet($this->basePath() . '/css/libraries/bootstrap.min.css')
                     ->prependStylesheet($this->basePath() . '/css/libraries/contextmenu.css');
      	}
      ?>

        <!-- Scripts -->
		<?php
			echo $this->headScript()
                     ->prependFile($this->basePath() . '/js/utilities.js')
                     ->prependFile($this->basePath() . '/js/libraries/bootbox.js')
                     ->prependFile($this->basePath() . '/js/libraries/jquery.ui.position.js')
                     ->prependFile($this->basePath() . '/js/libraries/jquery.contextmenu.js')
                     ->prependFile($this->basePath() . '/js/libraries/bootstrap-datepicker.js')
                     ->prependFile($this->basePath() . '/js/libraries/bootstrap.min.js')
                     ->prependFile($this->basePath() . '/js/libraries/jquery.min.js')
                     ->prependFile($this->basePath() . '/js/tuto.js');
        ?>
    </head>

    <script type="application/javascript">

        var tutoData = [];
        var current = 0;

        var nextTutorial = function() {

            if(tutoData.length != 0) { 
                var d = tutoData[current];

                $("div[role=tutorial][id = " + d.div + "]").html(
                    "<img src=/img/tuto.png /> " + d.text + "<a href='#' onClick='nextTutorial()'>   <br>Next</a>"
                ).fadeIn();

                $("div[role=tutorial][id != " + d.div + "]").fadeOut();

                current = (current + 1) % tutoData.length;
            }

        };

        function loadTutorial(tuto) {

            Tutorial(tuto, function(data) {
                
                var tutoDataFiltered = [];
                
                data.forEach(function(d) {
                    $("div[role=tutorial][id=" + d.div + "]").each(function() {

                        var div = $(this);
                        
                        tutoData.push({div: d.div, text: d.text});

                        var position = div.position();

                        div.css({
                            position: 'absolute',
                            top: position.top,
                            left: position.left,
                            width: position.width,
                            height: position.heigth,
                            paddingLeft: 25,
                            paddingRight: 25,
                            paddingBottom: 10,
                            paddingTop: 10,
                            borderRadius: 10,
                            background: "lightblue",
                            borderStyle: "solid"
                        });
                    });
                });
                
                nextTutorial();
            });
        };
        
    </script>

    <body>
	<div class="header">
	   <div class="container">
	      <a href="/" class="title"><img class="logo" src="<?php echo $this->basePath('img/title.svg'); ?>" height=70 /></a>
		  <?php
		  	if ($sessionUser && $sessionUser->connected)
			{
		  ?>
			  <div class="headerLinks">
			      <a href="<?php echo $this->basePath('projects'); ?>" class="btn btnHeaderSelected btn-link" type="button">Projects</a>
               <a href="<?php echo $this->basePath('edit'); ?>" class="btn btnHeader btn-link" type="button">Account</a>
               <a href="<?php echo $this->basePath('about/help'); ?>" class="btn btnHeader btn-link" type="button">Help</a>
			  </div>
		      <div class="headerRight">
		         <span class="loginInformation">Logged in as <b> <?php echo $sessionUser->username; ?> </b></span>
		         <a href="/logout" id="btnLogout" class="btn btnLogout btnEasygoing" type="button">Logout</a>
		      </div>
		 <?php } ?>
	   </div>
	</div>
	<div class="container">
		<div class="content mainContent">
			<?php echo $this->content; ?>
		</div>
		<div class="footer">
			EasyGoing! &copy; 2015
			<a href="/about" class="about">About</a>
		</div>
      </div> <!-- /container -->
      <?php echo $this->inlineScript() ?>
    </body>
</html>
